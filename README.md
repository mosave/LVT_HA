# LVT_HA
Home Assistant integration for Lite Voice Terminal


[![hacs_badge](https://img.shields.io/badge/HACS-Custom-41BDF5.svg)](https://github.com/hacs/integration)
[![Donate](https://img.shields.io/badge/donate-Yandex-orange.svg)](https://money.yandex.ru/to/)


![Lite Voice Terminal](https://github.com/mosave/LVTerminal/)

## Установка

Установка через HACS:

1. [Установите HACS](https://hacs.xyz/docs/installation/manual)
1. Перейдите в раздел  HACS -> Integrations
1. Нажмите кнопку "+", расположенную в нижней правой части экрана
1. Наберите "LVT" для поиска интеграции Lite Voice Terminal и установите ее
1. Перезапустите Home Assistant

Установка вручную:

1. Скачайте файл lvt.zip из раздела [релизы][latest-release]
2. Откройте папку конфигурации Home Assistant (в которой находится файл configuration.yaml), используя привычные вам инструменты
3. Распакуйте файлы из архива с подкаталогами в папку с конфигурацией HA
4. Перезапустите Home Assistant
5. Для выполнение базовой настройки LVT через web-интерйейс HA зайдите в "Configuration" -> "Integrations", нажмите "+" в правом нижнем углу и наберите "LVT" в строке поиска
6. Для выполнения полной настройки LVT через файл конфигурации configuration.yam - читайте раздел "Настройка".


## Сенсоры

### Общие сенсоры
 * **binary_sensor.lvt_online**

### Сенсоры, привязанные к LVT терминалам (speaker)

Каждцй терминал имеет свой уникальный идентификатор (speaker_id), настраиваемый на стороне сервера LVT. Интеграция отслеживает текущий статус терминалов и при создает соответствующие им устройства в Home Assistant.

Каждое устройство обладает следующим набором сущностей

  * **binary_sensor.lvt_<speaker_id>_online**
  * **number.lvt_<speaker_id>_volume**
  * **select.lvt_<speaker_id>_filter**
        0: Озвучивать все сообщения без исключений
        1: Озвучивать информационные сообщения
        2: Озвучивать только важные сообщения 
        3: Озвучивать только критически важные сообщения (пожар, протечка)
        4: Не озвучивать сообщения, инициированные на стороне сервера

## Сервисы

 При описании сервисов используются параметры:

  * **<speaker_id>**: Идентификатор или список идентификаторов терминалов. Если параметр не задан то используются все активные терминалы с соответствующими настройками уровеня фильтра важности.
    В качестве идентификатора можно указать:
    * speaker_id, ID LVT терминала
    * device_id, ID соответствующего устройства Home Assistant
    * entity_id либо unique_id любого компонента терминала (volume, filter, online).
    * area_id помещения, в котором установлены терминалы
  * **<importance>**: Уровень важности сообщения. Текст будет проговорен только на терминалах с соответствующим уровенем фильтрации
    * 0: Неважная болтовня (текущее время, здрасте-доствидания и тд)
    * 1: Информационное сообщение (пора заменить батарейки в датчике)
    * 2: Важное сообщение (звонок в дверь)
    * 3: Критически важное сообщение (пожар, протечка)
  * **<text>**: фраза или список фраз для проговаривания. Если список содержит несколько фраз то LVT выберет одну из них случайным образом
  * **<sound_effect>**: Имя звукового эффекта. Соответствующие .wav файлы находятся в каталогах /config или /lvt/sounds
  * **<utterance>**: Ключевая фраза или список ключевых фраз. Язык описания ключевых фраз описан ниже

**Проиграть звуковой эффект на терминалах**
```
lvt.play
    speaker: <speaker_id>                   # Список терминалов, на которых необходимо проговорить фразу
    importance: <importance>                # Важность сообщения (обязательный параметр)
    play: <sound_effect>
```

**Проговорить текст на терминалах**
```
lvt.say
    speaker: <speaker_id>                   # Список терминалов, на которых необходимо проговорить фразу
    importance: <importance>                # Важность сообщения (обязательный параметр)
    say: <text>
```


**Диалог выбора одного варианта из нескольких возможных**

```
lvt.negotiate
    speaker: <speaker_id>                   # Список терминалов, на которых нужно запустить диалог
    importance: <importance>                # Уровень важности
    say: <text>                             # Текст, проговариваемый при начале диалога
    prompt: <text>                          # Текст, проговариваемый если от пользователь игнорирует вопрос
                                            # Описание первого из возможноых вариантов выбора
    option-1-intent: <intent_id>            # Интент, вызываемый при выборе первого варианта
    option-1-utterance: <utterance>         # Ключевые фразы для выбора первого варианта
    option-2-say: <text>                    # Сообщения, подтверждающие выбор первого варианта
                                            # Описание второго варианта выбора (см. выше)
    option-2-intent: <intent_id>
    option-2-utterance: <utterance>
    option-2-say: <text>
        .....
                                            # Описание последнего варианта выбора (см. выше)
    option-N-intent: <intent_id>
    option-N-utterance: <utterance>
    option-N-say: <text>

    default-intent: <intent_id>             # Интент, вызываемый при отказе пользователя сделать выбор
    default-timeout: <seconds>              # Время (в секундах), в течение которого пользователю необходимо дать ответ
    default-say: <text>                     # Сообщение, подтверждающее отказ от выбора
```

**Подтверждение согласия**

```
lvt.confirm
    speaker: <speaker_id>                   # Список терминалов, на которых нужно запустить диалог
    importance: <importance>                # Уровень важности
    say: <text>                             # Текст, проговариваемый при начале диалога
    prompt: <text>                          # Текст, проговариваемый если от пользователь игнорирует вопрос
    yes_intent: <intent_id>                 # Интент, вызываемый при выражении согласия
    yes_say: <Text>                         # Сообщения, подтверждающие выбор первого варианта
    no_intent: <intent_id>                  # Интент, вызываемый при отказе
    no_say: <Text>                          # Сообщение, подтверждающее отказ
    default_intent: <intent_id>             # Интент, вызываемый при отказе пользователя сделать выбор
    default_timeout: <seconds>              # Время (в секундах), в течение которого пользователю необходимо дать ответ
    default_say: <text>                     # Сообщение, подтверждающее отказ от выбора
```


### Примеры вызова сервисов LVT





## Настройка

При установке интеграции через WEB интерфейс доступны только базовые настройки интеграции с LVT: отслеживание и отображение состояния терминалов, сервисы вывода голосовых сообщений и базовые диклоги.

Однако для тонкой настройки голосового взаимодействия Home Assistant с человеком с помощью LVT требуется редактирование файлов конфигурации.

Настройки соединения с LVT API сервером:
```
lvt
    server <LVT server address or host name>
    port <port number, default is 7999>
    password <password to connect>

```

```
lvt
    intent:
        name: <intent_id>
        heard: <список фраз>
        speaker: <speaker_id>

```


## Язык описания ключевых фраз (utterance)





## Отказ от ответственности
